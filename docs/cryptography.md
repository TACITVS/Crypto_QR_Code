# Cryptographic Architecture

This document provides a technical overview of the cryptographic components
used by the Secure QR Code Tool.  The goal is to make it straightforward for
auditors and integrators to understand the primitives that underpin the
application and how they interact with each other.

## Key Derivation

* **Primitive** – PBKDF2-HMAC with SHA-256.
* **Iterations** – Configurable via `AppConfig.pbkdf2_iterations` (default
  600,000) to provide resistance against brute-force attempts.
* **Salt** – Random 128-bit value generated with `os.urandom` for every
  encryption operation.
* **Output size** – 256-bit key used directly by the AES-256-GCM cipher.

The key derivation function is implemented in `CryptoManager._derive_key`.  The
derived key material never leaves the scope of the encrypt/decrypt helpers.

## Encryption and Authentication

* **Cipher** – AES in Galois/Counter Mode (AES-256-GCM) via
  `cryptography.hazmat.primitives.ciphers.aead.AESGCM`.
* **Nonce** – Random 96-bit value generated using `os.urandom`.
* **Associated data** – None (the system relies on the built-in authentication
  tag produced by GCM).
* **Output payload** – JSON-serialisable dictionary containing base64-encoded
  salt, nonce and ciphertext as well as the application version.

AES-GCM provides confidentiality and integrity.  The authentication tag is
embedded in the ciphertext returned by `AESGCM.encrypt`, ensuring tamper
detection during decryption.

## Mnemonic Handling

* **Mnemonic standard** – BIP-39 via the `mnemonic` library.
* **Strength** – Configurable (default 256 bits, producing 24-word phrases).
* **Validation** – Delegated to `Mnemonic.check`.
* **Checksum helper** – The `MnemonicManager.checksum` method computes the
  first six hexadecimal characters of the SHA-256 digest of the mnemonic.  The
  checksum is intended to help users visually detect transcription errors when
  recording phrases offline.

## QR Code Payloads and Hashing

QR codes are generated with the optional [`segno`](https://segno.readthedocs.io)
package.  The `QRCodeManager.save_png` helper serialises encryption payloads to
PNG images.  After encoding the payload it returns a checksum generated by
`QRCodeManager.payload_digest`:

* **Hash function** – SHA-256 applied to the UTF-8 encoded QR payload.
* **Digest format** – Lowercase hexadecimal string.

The checksum can be stored alongside the QR image or displayed to the user.
When a QR code is scanned, recomputing the digest on the decoded payload and
comparing it against the recorded value provides a simple integrity check
before attempting decryption.
